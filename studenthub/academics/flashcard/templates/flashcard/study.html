{% extends 'hub/base.html' %}
{% load static %}

{% block title %}
    StudentHub || Trivia
{% endblock %}


{% block content %}
    <h1 align="center" id="heading1">Study Flashcards!</h1>
    <div id="result-status"></div>

    <div id="question-block" style="width:30%">

    </div>
    {% if error %}
        <p>{{ error }}</p>
    {% endif %}

    <form method="post" action="results" > {% csrf_token %}
        <input type="submit" value="Study More" id="submit-button">
    </form>
    <hr>

{% endblock %}

{% block script %}



    <!-- <script src="{% static "flashcards/study.js" %}"></script> -->
    <script>
        const FLASHCARD_QTY = 'qty'; // name for hidden field with question count qty
        const FLASHCARD_CLASS = 'flashcard'; // class assigned to each Question div
        const QUESTION = 'question';
        // import data from view context
        {% if qty %}
            var flashcardQty = {{ qty }};
        {% endif %}

        var flashcardList = []; // declare list of questions
        var parsedFlashcards = []; // list of parsed objects containing questions

        console.log("this is a test");
        console.log({{ flashcards_json|safe }});
        {% if flashcards_json %}
            parsedFlashcards = JSON.parse('{{ flashcards_json|safe }}');
            console.log(parsedFlashcards);
        {% endif %}
        console.log(parsedFlashcards[0]);
        console.log(parsedFlashcards[0].fields.question);

        /*
        // Iteratively create list of Questions
        for (var i = 0; i < parsedFlashcards.length; i++) {
            // TODO: filter &quote; and similiar strings
            var importedFlashcard = JSON.parse(parsedFlashcards[i]);
            //var flashcard = {

            //};
            //    new TypedQuestion(parsedQuestions[i].question,
            //    parsedQuestions[i].choices, parsedQuestions[i].question_type);
            // Append TypedQuestion to list
            flashcardList.push(importedFlashcard);
        }
        */

        for (i = 0; i < flashcardQty; i++) {
            // first iteration
            if (i === 0) {
                // Add Flashcard question
                var flashcardElement = document.createElement("div");
                flashcardElement.setAttribute("class", FLASHCARD_CLASS);
                flashcardElement.setAttribute("id", QUESTION + 0);
                flashcardElement.setAttribute("style", 'text-align:center');


                var textContent = document.createTextNode(parsedFlashcards[0].fields.question);
                flashcardElement.appendChild(textContent);

                // line break
                flashcardElement.appendChild(document.createElement("br"));

                // Add Flashcard short answer
                var answerField = document.createElement("INPUT");
                answerField.setAttribute("type", "text");
                answerField.setAttribute("id", "selected-answer");
                answerField.setAttribute("name", "answer-0");
                flashcardElement.appendChild(answerField);
                // line break
                flashcardElement.appendChild(document.createElement("br"));

                // Add buttons
                var answerButton = document.createElement("BUTTON");
                answerButton.innerHTML = "Check";
                answerButton.onclick = function() {
                    var selectedAnswer = document.getElementById('selected-answer');
                    console.log(parsedFlashcards);
                    console.log(selectedAnswer.value);
                    if (selectedAnswer.value == parsedFlashcards[0].fields.answer) {
                        document.getElementById('result-status').textContent = 'Correct!'

                    }
                    else {
                        document.getElementById('result-status').textContent = 'Incorrect!'

                    }
                    // TODO: iterate to new card

                };
                flashcardElement.appendChild(answerButton);


                // Add flashcard with elements to page
                // Insert question text after page text with passed id
                var pageElement = document.getElementById('question-block');
                pageElement.appendChild(flashcardElement);
            }

        }

</script>

{% endblock %}